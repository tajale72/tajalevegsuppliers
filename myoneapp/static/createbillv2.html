<!DOCTYPE html>
<html lang="ne">

<head>
  <meta charset="UTF-8" />
  <title>Tajale Veg Suppliers</title>
  <link rel="stylesheet" href="createbillV2.css" />
  <link href="https://nepalidatepicker.sajanmaharjan.com.np/nepali.datepicker/css/nepali.datepicker.v4.0.4.min.css"
    rel="stylesheet" type="text/css" />
  <script src="https://nepalidatepicker.sajanmaharjan.com.np/nepali.datepicker/js/nepali.datepicker.v4.0.4.min.js"
    type="text/javascript"></script>

  <style>

  </style>

</head>

<body>

  <div class="navbar">
    <a href="createbillv2.html">Create Bill</a>
    <a href="allproducts.html">Transactions</a>

    <a href="vegetablecount.html">Vegetable Count</a>
    <a href="ledger.html">Ledger</a>
 <a href="dashboard.html">Dashboard</a>
  </div>
  <div class="bill-container">
    <div class="title-container">
      <h1 id="title">तजले भेज सप्लायर्स</h1>
      <h3 id="slogan">आलु प्याज तथा तरकारी भण्डार</h3>
      <p id="sellerlocation">कमलबिनायक-१०, भक्तपुर</p>
      <p id="phone">फोन: ०१-६६१६२७७ मो:९८४१६९२२११</p>
    </div>
    <p>बिल नं <input type="text" id="billNumber" required /></p>
    <p>
      पान.नं: <span id="panContainer"></span>
      <span class="date-label">मिति:</span>
      <input type="text" id="nepali-datepicker" placeholder="Select Nepali Date" />
    </p>
    <p>श्री: &nbsp;<input type="text" class="input-field" id="customerName" /></p>
    <p>
      ठेगाना:<input type="text" class="input-field" id="location" />
      फोन:<input type="text" class="input-field" id="customerPhoneNumber" />
    </p>
    <p>क्रेतिको पान.नं: <span id="customer-panContainer"></span></p>

    <table id="billTable">
      <thead>
        <tr>
          <th class="center-align">क्र स</th>
          <th class="center-align">विवरण</th>
          <th class="center-align">मात्रा (kg)</th>
          <th class="center-align">(दर/kg)</th>
          <th class="center-align">रकम (RS)</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- Rows will be inserted here -->
      </tbody>
      <tfoot>
        <tr class="sum-row">
          <td colspan="3">
          </td>
          <td>
            <input type="text" id="totalDebit" class="table-input"  placeholder="Debit" />
          </td>
          <td>
            <input type="text" id="totalCredit" class="table-input" placeholder="Credit" />
          </td>
        </tr>
        <tr class="sum-row">
          <td colspan="4">
            जम्मा: <input type="text" class="total-sum-text" />
          </td>
          <td>
            <input type="text" id="grandTotal" class="table-input" readonly />
          </td>
        </tr>
      </tfoot>
    </table>
    <p>
      "भोज तथा पिकनिकको ठोक तथा खुर्दा तरकारी स्वयं मुल्ले मा पाइन्छ। # होम
      डेलिभरी पनि व्यवस्था छ।"
    </p>
    <div class="sign-container">
      <div class="input-wrapper" style="text-align: left;">
        <p>क्रेतिको साइन इन : <input type="text" class="input-field" id="customerSignature" /></p>
      </div>
      <div class="input-wrapper" style="text-align: right;">
        <p>तजले भेजसप्लायर्स : <input type="text" class="input-field" id="sellerSignature" /></p>
      </div>
    </div>


  </div>
  </div>
  <div class="bill-container">
    <div class="create-bill">
      <button id="createBillButton">Create Bill</button>
    </div>
    <div class="save-bill">
      <button id="saveBillButton">Save</button>
    </div>

    <div>
      <form id="uploadForm" action="http://localhost:8080/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="image" accept="image/*" required>
        <button type="submit">Upload</button>
    </form>

    <p id="responseMessage"></p>
    </div>
  </div>



  <script>
    const form = document.getElementById('uploadForm');
    const responseMessage = document.getElementById('responseMessage');

    form.addEventListener('submit', async (event) => {
        event.preventDefault();
        
        const formData = new FormData(form);

        try {
            const response = await fetch(form.action, {
                method: 'POST',
                body: formData,
            });

            const text = await response.text();
            responseMessage.textContent = text;
        } catch (error) {
            responseMessage.textContent = 'An error occurred while uploading the file.';
        }
    });
</script>








  <script>
    function calculateTotal() {
      const table = document.getElementById("billTable");
      let grandTotal = 0;
      for (let i = 0; i < 30; i++) {
        const quantity =
          table.rows[i + 1].cells[2].getElementsByTagName("input")[0].value;
        const price =
          table.rows[i + 1].cells[3].getElementsByTagName("input")[0].value;
        const totalCell =
          table.rows[i + 1].cells[4].getElementsByTagName("input")[0];
        const total = quantity * price;
        totalCell.value = total;
        grandTotal += total;
      }
      document.getElementById("grandTotal").value = grandTotal;
    }
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", (event) => {
      const panNumber = "६०१०८६४८९";
      const panContainer = document.getElementById("panContainer");
      for (let digit of panNumber) {
        let input = document.createElement("input");
        input.type = "text";
        input.value = digit;
        input.className = "pan-input";
        input.readOnly = true;
        panContainer.appendChild(input);
      }
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", (event) => {
      const panContainer = document.getElementById("customer-panContainer");
      for (let i = 0; i < 9; i++) {
        let input = document.createElement("input");
        input.type = "text";
        input.className = "pan-input";
        input.maxLength = 1; // Ensure only one character per input box

        input.addEventListener("input", function () {
          if (this.value.length === this.maxLength) {
            const nextInput = this.nextElementSibling;
            if (nextInput) {
              nextInput.focus();
            }
          }
        });

        panContainer.appendChild(input);
      }
    });
  </script>

  <script type="text/javascript">
    window.onload = function () {
      var mainInput = document.getElementById("nepali-datepicker");
      mainInput.nepaliDatePicker();
    };
  </script>
  <script>
    document
      .getElementById("createBillButton")
      .addEventListener("click", () => {
        const billNumber = document.getElementById("billNumber").value;
        const billDate = document.getElementById("nepali-datepicker").value;
        const sellerName = document.getElementById("title").innerText;
        const sellerPanNum = "६०१०८६४८९";

        const customerName = document.getElementById("customerName").value;
        const customerLocation = document.getElementById("location").value;
        const customerPhoneNumber = document.getElementById("customerPhoneNumber").value;
        
        // Fetch the total debit and credit values
        const totalDebit = parseFloat(document.getElementById("totalDebit").value) || 0;
        const totalCredit = parseFloat(document.getElementById("totalCredit").value) || 0;

        const billTotalAmount = document.getElementById("grandTotal").value
        const customerPanContainer = Array.from(
          document.querySelectorAll("#customer-panContainer input")
        )
          .map((input) => input.value)
          .join("");

        // Create an object to store the data
        const billData = {
          billNumber: billNumber,
          billDate: billDate,
          sellerName: sellerName,
          sellerPanNum: sellerPanNum,
          customerName: customerName,
          customerLocation: customerLocation,
          customerPhoneNumber: customerPhoneNumber,
          customerPanContainer: customerPanContainer,
          totalDebit: totalDebit,
          totalCredit : totalCredit,
          billTotalAmount: billTotalAmount,
          items: [],
        };

        // Get the table data
        const table = document.getElementById("billTable");
        if (table) {
          const tbody = table.getElementsByTagName("tbody")[0];
          if (tbody) {
            const rows = tbody.getElementsByTagName("tr");
            for (let i = 0; i < rows.length; i++) {
              const cells = rows[i].getElementsByTagName("td");
              const item = {
                kra: cells[0].innerText, // Get the index (Kra) from the first cell
                sa: cells[1].getElementsByTagName("input")[0].value, // Get value from the vegetable input field
                sankhya: cells[2].getElementsByTagName("input")[0].value, // Get the quantity from the input field
                dar: cells[3].getElementsByTagName("input")[0].value, // Get the price from the input field
                rakam: cells[4].getElementsByTagName("input")[0].value, // Get the total amount from the input field
              };
              billData.items.push(item); // Add the item to the billData array
            }
          }
        }

        // Example API call to send the data
        fetch("http://localhost:8080/billtransaction", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(billData),
        })
          .then((response) => {
            if (!response.ok) {
              // If the response status is not OK (i.e., status is not 200), throw an error
              return response.json().then((errorData) => {
                throw new Error(`Error ${response.status}: ${errorData.message || response.statusText}`);
              });
            }
            return response.json();
          })
          .then((data) => {
            console.log("Success:", data);
            alert("Bill created successfully!");
          })
          .catch((error) => {
            console.error("Error:", error);
            alert(`An error occurred while creating the bill: ${error.message}. Please try again later.`);
          });
      });
  </script>
</body>

</html>

<script>
  document.addEventListener("DOMContentLoaded", (event) => {
    fetch("http://localhost:8080/getBillNumber")
      .then((response) => response.json())
      .then((data) => {
        // Assuming the bill number is returned in the 'billNumber' property of the response
        const billNumber = data.billNumber;
        document.getElementById("billNumber").value = billNumber;
      })
      .catch((error) => {
        console.error("Error fetching bill number:", error);
      });
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", (event) => {
    const signInputs = document.querySelectorAll(".input-field-sign");
    signInputs.forEach((input) => {
      input.maxLength = 1; // Ensure only one character per input box

      input.addEventListener("input", function () {
        if (this.value.length === this.maxLength) {
          const nextInput = this.nextElementSibling;
          if (nextInput && nextInput.classList.contains("input-field-sign")) {
            nextInput.focus();
          }
        }
      });
    });
  });
</script>

<script>
  // Generate table rows dynamically
  const tableBody = document.getElementById('tableBody');

  for (let i = 0; i < 30; i++) {
    tableBody.innerHTML += `
      <tr>
        <td>${i + 1}</td>
        <td>
          <input type="text" placeholder="Search.." id="myInput${i}" onkeyup="autoComplete(${i})" onfocus="showAllOptions(${i})">
          <datalist id="vegetableList${i}">
            <option value="Apple - स्याउ (Syaau)">Apple - स्याउ (Syaau)</option>
            <option value="Artichoke - आर्टिचोक (Artichoke)">Artichoke - आर्टिचोक (Artichoke)</option>
            <option value="Asparagus - अस्पैरेगस (Asparagus)">Asparagus - अस्पैरेगस (Asparagus)</option>
            <option value="Banana - केरा (Kera)">Banana - केरा (Kera)</option>
            <option value="Beans - सिमी (Simi)">Beans - सिमी (Simi)</option>
            <option value="Beet - चकुन्दर (Chakundar)">Beet - चकुन्दर (Chakundar)</option>
            <option value="Bell Pepper - बेल पेपर (Bell Pepper)">Bell Pepper - बेल पेपर (Bell Pepper)</option>
            <option value="Bitter Gourd - करेले (Karela)">Bitter Gourd - करेले (Karela)</option>
            <option value="Black Mushroom - कालो च्याउ (Kalo Chyau)">Black Mushroom - कालो च्याउ (Kalo Chyau)</option>
            <option value="Bodi - बोडी (Bodi)">Bodi - बोडी (Bodi)</option>
            <option value="Brinjal - भाँटा (Bhanta)">Brinjal - भाँटा (Bhanta)</option>
            <option value="Broccoli - ब्रोकोली (Broccoli)">Broccoli - ब्रोकोली (Broccoli)</option>
            <option value="Cabbage - बन्दगोभी (Bandgobhi)">Cabbage - बन्दगोभी (Bandgobhi)</option>
            <option value="Capsicum - क्याप्सिकम (Capsicum)">Capsicum - क्याप्सिकम (Capsicum)</option>
            <option value="Carrot - गाजर (Gajar)">Carrot - गाजर (Gajar)</option>
            <option value="Cauliflower - काउली (Cauliflower)">Cauliflower - काउली (Cauliflower)</option>
            <option value="Cardinier - कार्डिनियर (Cardinier)">Cardinier - कार्डिनियर (Cardinier)</option>
            <option value="Cardinier Leaves - कार्डिनियर पात (Cardinier Leaves)">Cardinier Leaves - कार्डिनियर पात (Cardinier Leaves)</option>
            <option value="Celery - सेलेरी (Celery)">Celery - सेलेरी (Celery)</option>
            <option value="Chili - खुर्सानी (Khursani)">Chili - खुर्सानी (Khursani)</option>
            <option value="Chyau Patey - च्याउ पाते (Chyau Patey)">Chyau Patey - च्याउ पाते (Chyau Patey)</option>
            <option value="Corn - मक्का (Makka)">Corn - मक्का (Makka)</option>
            <option value="Cucumber - काक्रो (Kakro)">Cucumber - काक्रो (Kakro)</option>
            <option value="Dhaniya - धनियाँ (Dhaniya)">Dhaniya - धनियाँ (Dhaniya)</option>
            <option value="Eggplant - भिण्डी (Bhindi)">Eggplant - भिण्डी (Bhindi)</option>
            <option value="Garlic - लसुन (Lasun)">Garlic - लसुन (Lasun)</option>
            <option value="Ghiraula - घिरौंला (Ghiraula)">Ghiraula - घिरौंला (Ghiraula)</option>
            <option value="Ginger - अदुवा (Aduwa)">Ginger - अदुवा (Aduwa)</option>
            <option value="Golo Chyau - गोलो च्याउ (Golo Chyau)">Golo Chyau - गोलो च्याउ (Golo Chyau)</option>
            <option value="Grapes - अंगुर (Angur)">Grapes - अंगुर (Angur)</option>
            <option value="Green Chillies - हरियो खुर्सानी (Hariyo Khursani)">Green Chillies - हरियो खुर्सानी (Hariyo Khursani)</option>
            <option value="Green Onion - हरियो प्याज (Hariyo Pyaj)">Green Onion - हरियो प्याज (Hariyo Pyaj)</option>
            <option value="Gundruk - गुन्द्रुक (Gundruk)">Gundruk - गुन्द्रुक (Gundruk)</option>
            <option value="Hariyo Lasun - हरियो लसुन (Hariyo Lasun)">Hariyo Lasun - हरियो लसुन (Hariyo Lasun)</option>
            <option value="Hariyo Simi - हरियो सिमी (Hariyo Simi)">Hariyo Simi - हरियो सिमी (Hariyo Simi)</option>
            <option value="Iskus - इस्कुस (Iskus)">Iskus - इस्कुस (Iskus)</option>
            <option value="Kagati - कागती (Kagati)">Kagati - कागती (Kagati)</option>
            <option value="Karela - करेला (Karela)">Karela - करेला (Karela)</option>
            <option value="Kiwi - कीवी (Kiwi)">Kiwi - कीवी (Kiwi)</option>
            <option value="Lapsi Mada - लप्सी माडा (Lapsi Mada)">Lapsi Mada - लप्सी माडा (Lapsi Mada)</option>
            <option value="Leek - लेक (Leek)">Leek - लेक (Leek)</option>
            <option value="Lemon - कागती (Lemon)">Lemon - कागती (Lemon)</option>
            <option value="Mango - आँप (Aap)">Mango - आँप (Aap)</option>
            <option value="Maywa - मैवा (Maywa)">Maywa - मैवा (Maywa)</option>
            <option value="Mushroom - च्याउ (Chyau)">Mushroom - च्याउ (Chyau)</option>
            <option value="Naspati - नासपाती (Naspati)">Naspati - नासपाती (Naspati)</option>
            <option value="Onion - प्याज (Pyaj)">Onion - प्याज (Pyaj)</option>
            <option value="Orange - सुन्तला (Suntala)">Orange - सुन्तला (Suntala)</option>
            <option value="Pakucha Saag - पक्कुचा साग (Pakucha Saag)">Pakucha Saag - पक्कुचा साग (Pakucha Saag)</option>
            <option value="Palak Sag - पालक साग (Palak Sag)">Palak Sag - पालक साग (Palak Sag)</option>
            <option value="Papaya - पपया (Papaya)">Papaya - पपया (Papaya)</option>
            <option value="Parsley - पार्स्ले (Parsley)">Parsley - पार्स्ले (Parsley)</option>
            <option value="Parwal - परवल (Parwal)">Parwal - परवल (Parwal)</option>
            <option value="Peach - आडु (Aadu)">Peach - आडु (Aadu)</option>
            <option value="Peas - केराउ (Keraau)">Peas - केराउ (Keraau)</option>
            <option value="Pear - नासपाती (Nasapati)">Pear - नासपाती (Nasapati)</option>
            <option value="Pineapple - अनानास (Ananas)">Pineapple - अनानास (Ananas)</option>
            <option value="Plum - आलुबलु (Alublu)">Plum - आलुबलु (Alublu)</option>
            <option value="Pomegranate - अनार (Anar)">Pomegranate - अनार (Anar)</option>
            <option value="Potato - आलु (Aalu)">Potato - आलु (Aalu)</option>
            <option value="Pumpkin - फर्सी (Pharsi)">Pumpkin - फर्सी (Pharsi)</option>
            <option value="Pudina - पुदिना (Pudina)">Pudina - पुदिना (Pudina)</option>
            <option value="Radicchio - राडिचिओ (Radicchio)">Radicchio - राडिचिओ (Radicchio)</option>
            <option value="Radish - मूला (Mula)">Radish - मूला (Mula)</option>
            <option value="Ramtoria - रामतोरिया (Ramtoria)">Ramtoria - रामतोरिया (Ramtoria)</option>
            <option value="Rayo Saag - रायो साग (Rayo Saag)">Rayo Saag - रायो साग (Rayo Saag)</option>
            <option value="Rhubarb - र्हुबर्ब (Rhubarb)">Rhubarb - र्हुबर्ब (Rhubarb)</option>
            <option value="Salad Patta - सलाद पत्ता (Salad Patta)">Salad Patta - सलाद पत्ता (Salad Patta)</option>
            <option value="Saag - साग (Saag)">Saag - साग (Saag)</option>
            <option value="Small Tomato - सानो टमाटर (Sano Tamatar)">Small Tomato - सानो टमाटर (Sano Tamatar)</option>
            <option value="Spinach - पालुङ्गो (Palungo)">Spinach - पालुङ्गो (Palungo)</option>
            <option value="Spring Garlic - हरियो लसुन (Spring Garlic)">Spring Garlic - हरियो लसुन (Spring Garlic)</option>
            <option value="Spring Ginger - हरियो अदुवा (Spring Ginger)">Spring Ginger - हरियो अदुवा (Spring Ginger)</option>
            <option value="Strawberry - स्ट्रबेरी (Strawberry)">Strawberry - स्ट्रबेरी (Strawberry)</option>
            <option value="Sukeko Pyaaj - सुकाएको प्याज (Sukeko Pyaaj)">Sukeko Pyaaj - सुकाएको प्याज (Sukeko Pyaaj)</option>
            <option value="Tomato - टमाटर (Tamatar)">Tomato - टमाटर (Tamatar)</option>
            <option value="Vede Khursani - भेडे खुर्सानी (Bhede Khursani)">Vede Khursani - भेडे खुर्सानी (Bhede Khursani)</option>
            <option value="Watermelon - खरबुजा (Kharbuja)">Watermelon - खरबुजा (Kharbuja)</option>
            <option value="Zucchini - जुचिनी (Zucchini)">Zucchini - जुचिनी (Zucchini)</option>




          </datalist>
        </td>
        <td><input type="number" class="table-input" oninput="calculateTotal()" /></td>
        <td><input type="number" class="table-input" oninput="calculateTotal()" /></td>
        <td><input type="text" class="table-input" readonly /></td>
      </tr>`;
  }

  function autoComplete(index) {
    const input = document.getElementById(`myInput${index}`);
    const list = document.getElementById(`vegetableList${index}`);
    input.setAttribute("list", `vegetableList${index}`);
  }

  function showAllOptions(index) {
    const input = document.getElementById(`myInput${index}`);
    const list = document.getElementById(`vegetableList${index}`);
    input.setAttribute("list", `vegetableList${index}`);
  }

  function calculateTotal() {
    const table = document.getElementById("billTable");
    let grandTotal = 0;
    for (let i = 0; i < 30; i++) {
      const quantity =
        table.rows[i + 1].cells[2].getElementsByTagName("input")[0].value;
      const price =
        table.rows[i + 1].cells[3].getElementsByTagName("input")[0].value;
      const totalCell =
        table.rows[i + 1].cells[4].getElementsByTagName("input")[0];
      const total = quantity * price;
      totalCell.value = total;
      grandTotal += total;
    }
    document.getElementById("grandTotal").value = grandTotal;
  }
</script>